<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
	<link rel="stylesheet" href="<%=request.getContextPath()%>/css/book.css">
	<script src="js/httpRequest.js"></script>
	<script>
		/* onclick 버튼을 눌러서 함수 실행 / Ajax 사용*/
		function m_send(f){
			
		   let url = "list.do"; // 서블릿으로 요청을 보넴
		   let param = "search_txt="+f.search_txt.value; // 받은 파라미터  같이 보넴
		   sendRequest(url, param, resultFn, "get"); // 서블릿에서 콜백으로 돌아올 함수
		   
		}
		
		    function resultFn(){
		       if(xhr.readyState == 4 && xhr.status == 200 ){
		          // 응답 완료 				정상
		    	   let data = xhr.responseText; // 콜백으로 받은 JSON 문자열로 받아옴
		    	   let json = eval(data); // 문자열을 실제 JSON 객체로 변환
		    	   
		    	   let resTable = document.getElementById("resTable");
		    	   resTable.innerHTML = ""; // 이전 결과 지움
		    	   
		    	   //가져온 도서 수 만큼 반복
		    	   json[0].items.forEach( item => {
		    		   let row = document.createElement("tr");  // 새 <tr> 하나 만들기
		    		   
		    		   let price = Number(item.discount).toLocaleString();
		    		   
		    		   row.innerHTML = "<td><img src='"+ item.image + "' width='100'></td>" +
		    		   					"<td><span>"+item.title+"</span>"+
		    		   					"<br>저자 :"+item.author + 
		    		   					"가격 :<span class='price'>" + price + "원</span>"
		    		   					"</td>"
		    		   					
		    		   	resTable.appendChild(row);	// 새 <tr> 에 자동으로 정보 담기			
		    	   } );
		    	   
		       }
		    }
	</script>
</head>
<body>
	<form>
		<input name="search_txt"/>
		<input type="button" value="검색" onclick="m_send(this.form)">
		
		<table id="resTable" border="1"></table>
	
	</form>
</body>
</html>